{%- assign on_sale = false -%}
{%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
    {%- assign on_sale = true -%}
{%- endif -%}
{%- assign image_width = '565x' -%}
{%- if settings_gallery_previews_pos == 'prd-block--prv-right' or settings_gallery_previews_pos == 'prd-block--prv-left' -%}
    {%- assign image_width = '650x' -%}
{%- endif -%}
{%- if settings_gallery_previews_pos == 'prd-block--prv-bottom prd-block--prv-double' or settings_gallery_previews_pos == 'prd-block--prv-bottom' -%}
    {%- assign image_width = '693x' -%}
{%- endif -%}
{%- if settings_gallery_previews_pos == 'grid' -%}
    {%- assign image_width = '470x' -%}
{%- endif -%}
{%- if settings_show_title_top -%}
    <div class="prd-block_info js-prd-m-holder mb-2 mb-md-0"></div>
{%- endif -%}
<!-- Product Gallery -->
{%- assign featured_image = product.selected_or_first_available_variant.featured_image | default: product.featured_image -%}
{%- if settings_gallery_previews_pos == 'grid' -%}
    <div class="prd-block_images-grid">
        <div class="row justify-content-center">
            {%- for image in product.media -%}
            {%- if image.media_type == "external_video" -%}
                <div class="col-18 prd-block_gallery-video" data-image-id="{{ image.id }}">
                    {{ image | external_video_url: autoplay: "0" |  external_video_tag: image_size: image_width, scale:2 }}
                </div>
            {%- elsif image.media_type == "video" -%}
                <div class="col-18 prd-block_gallery-video" data-image-id="{{ image.id }}">
                    {{ image | video_tag: controls: true, image_size: image_width, scale:2  }}
                </div>
            {%- else -%}
                {%- if image.alt == "MAIN" or image.alt == "HOVER" -%} {% continue %} {%- endif -%}
                <div class="col-9" data-image-id="{{ image.id }}">
                    {%- assign aspect_ratio = 1 | divided_by: image.aspect_ratio -%}
                    <a href="{{ image.src | img_url: 'master' }}" data-fancybox="gallery" class="image-container" style="padding-bottom: {{ aspect_ratio | times: 100 }}%">
                        <img data-srcset="{{ image.src | img_url: image_width }} 1x,{{ image.src | img_url: image_width, scale:2 }} 2x" class="lazyload fade-up" alt="" />
                        <div class="foxic-loader"></div>
                    </a>
                </div>
            {%- endif -%}
            {%- endfor -%}
        </div>
    </div>
{%- else -%}
    <div class="prd-block_main-image" data-product-media>
        <div class="prd-block_main-image-holder {% if settings.label_shadow %}prd-labels-shadow{% endif %}"  id="prdMainImage">
            <div class="product-main-carousel {% if product.images.size > 1 %}js-product-main-carousel{% endif %}" data-zoom-position="inner">
                {%- for image in product.media -%}
                {%- if image.media_type == "external_video" -%}
                    <div data-image-id="{{ image.id }}" class="external-video js-external-video">
                        {{ image | external_video_url: autoplay: "0" |  external_video_tag }}
                    </div>
                {%- elsif image.media_type == "video" -%}
                    <div data-image-id="{{ image.id }}" class="inner-video js-inner-video">
                        {{ image | video_tag: controls: true, image_size: image_width }}
                    </div>
                {%- else -%}
                    {%- if image.alt == "MAIN" or image.alt == "HOVER" -%} {% continue %} {%- endif -%}
                    {%- assign aspect_ratio = 1 | divided_by: image.aspect_ratio -%}
                    <div data-image-id="{{ image.id }}" class="media-image">{% if settings.equal_height %}<span><span>{% else %}<span class="image-container" style="padding-bottom: {{ aspect_ratio | times: 100 }}%">{% endif %}<img data-aspectratio="{{ image.aspect_ratio }}" data-src="{{ image.src | img_url: image_width }} 1x,{{ image.src | img_url: image_width, scale:2 }} 2x" class="lazypreload lazyload {% if section.settings.zoom %}elzoom{% endif %}" alt="" data-image-width="{{ image.width }}" data-zoom-image="{{ image.src | img_url: 'master' }}" /><i class="foxic-loader"></i>{% if settings.equal_height %}</span></span>{% else %}</span>{% endif %}</div>
                {%- endif -%}
                {%- endfor -%}
            </div>
            {% include 'product-labels' %}
        </div>
        <div class="prd-block_main-image-links">
            {%- assign video_youtube = product.metafields.c_f.video -%}
            {%- if video_youtube != blank -%}
                <a data-fancybox  data-width="800" data-height="450" href="{{ video_youtube }}" class="prd-block_video-link"><i class="icon-play"></i></a>
            {%- endif -%}
            <a href="{{ featured_image.src | img_url: 'master' }}" class="prd-block_zoom-link"><i class="icon-zoom-in"></i></a>
        </div>
    </div>
    {%- if settings_gallery_previews and product.images.size > 1 -%}
        {%- assign previews = false -%}
        {%- for image in product.images -%} {%- if image.alt == "MAIN" or image.alt == "HOVER" or forloop.first -%} {% continue %} {%- endif -%} {% assign previews = true %} {% break %} {%- endfor -%}
        {%- if previews -%}
            <div class="product-previews-wrapper">
                <div class="product-previews-carousel js-product-previews-carousel" {% if settings_per_col_custom %}data-desktop="{{ settings_per_col_desktop }}" data-tablet="{{ section.settings.per_col_tablet }}"{% endif %}>

                    {%- for image in product.media -%}
                        {%- if image.media_type == "external_video" or image.media_type == "video" -%}
                            {%- if section.settings.video_preview != 'none' -%}
                                <a href="#" title={{ image.alt }} data-value="{{ image.src | split:'products/' | last | split:'.' | first }}"  data-image-id="{{ image.id }}" class="prd-block_video-link video-slide {% if featured_image == image %}active{% endif %}"><span><span>
                                    {%- if section.settings.video_preview == 'icon' -%}<i class="icon icon-play"></i>{%- endif -%}
                                    <img class="lazyload" data-aspectratio="{{ image.aspect_ratio }}" src="{{ image | img_url: '100x' }}" data-srcset="{{ image | img_url: '200x' }} 1x,{{ image | img_url: '200x', scale:2 }} 2x" alt="{{ featured_image.alt | escape }}" />
                                </span></span></a>
                            {%- endif -%}
                        {%- else -%}
                            {% if forloop.index0 == 0 %}{%- assign image_aspect = 1 | divided_by:image.aspect_ratio -%}{% endif %}
                            {%- if image.alt == "MAIN" or image.alt == "HOVER" -%} {% continue %} {%- endif -%}
                            <a href="{{ image.src | img_url: 'master' }}" title={{ image.alt }} data-value="{{ image.src | split:'products/' | last | split:'.' | first }}"  data-image-id="{{ image.id }}" {% if featured_image == image %}class="active"{% endif %}><span><span><img class="lazyload" data-aspectratio="{{ image.aspect_ratio }}" src="{{ image.src | img_url: '100x' }}" data-srcset="{{ image.src | img_url: '200x' }} 1x,{{ image.src | img_url: '200x', scale:2 }} 2x" alt="{{ featured_image.alt | escape }}" /></span></span></a>
                        {%- endif -%}
                    {%- endfor -%}
                </div>
            </div>
        {%- endif -%}
    {%- endif -%}
{%- endif -%}
<style>
    body:not(.equal-height) .product-previews-carousel.slick-vertical a > span, .product-previews-carousel a.prd-block_video-link > span{
        display: block;
        position: relative;
        border: 0;
        height: 0;
        overflow: hidden;
        padding-bottom: {{ image_aspect  | times: 100 | floor }}%;
    }
    body:not(.equal-height) .product-previews-carousel.slick-vertical a > span > span, .product-previews-carousel a.prd-block_video-link > span > span {
        position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    body:not(.equal-height) .product-previews-carousel.slick-vertical a > span img {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    {%- unless settings.color_ppage_video_bg == '' or settings.color_ppage_video_bg contains 'rgba(0,0,0,0)' -%}
    .slick-slide.external-video, .slick-slide.inner-video {
        background: {{ settings.color_ppage_video_bg }};
    }
    {%- endunless -%}
</style>
<!-- /Product Gallery -->